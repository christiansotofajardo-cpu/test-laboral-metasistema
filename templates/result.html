<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reporte — Test Laboral MetaSistema</title>

  <link rel="stylesheet" href="/static/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div class="container">

  <!-- ================================================= -->
  <!-- ENCABEZADO -->
  <!-- ================================================= -->
  <div class="card">
    <h1>Reporte de Evaluación Comunicativa Laboral</h1>
    <div class="small">
      Test Laboral MetaSistema — IPIP-100 + Producción escrita
    </div>
  </div>

  <!-- ================================================= -->
  <!-- RESUMEN EJECUTIVO -->
  <!-- ================================================= -->
  <div class="card highlight">
    <h2>Resumen ejecutivo</h2>
    <p>{{ reporte["resumen"] }}</p>
    <p class="small">
      Estado de análisis lingüístico: <b>{{ reporte["status_trunajod"] }}</b>
    </p>
  </div>

  <!-- ================================================= -->
  <!-- GRÁFICOS -->
  <!-- ================================================= -->
  {% set sf = analisis_discursivo["scores_sensibles"]["funcional"] %}
  {% set ss = analisis_discursivo["scores_sensibles"]["situacional"] %}
  {% set sg = analisis_discursivo["scores_sensibles"]["global_promedio"] %}

  <div class="card">
    <h2>Indicadores visuales de desempeño</h2>

    <div class="grid-2">
      <div>
        <h3>Score comunicativo global</h3>
        <canvas id="chartGlobal"></canvas>
      </div>

      <div>
        <h3>Funcional vs. Situacional</h3>
        <canvas id="chartTasks"></canvas>
      </div>
    </div>

    <div class="spacer"></div>

    <h3>Perfil de personalidad (IPIP-100)</h3>
    <canvas id="chartIPIP"></canvas>
  </div>

  <!-- ================================================= -->
  <!-- FORTALEZAS -->
  <!-- ================================================= -->
  <div class="card">
    <h2>Fortalezas observadas en el desempeño comunicativo</h2>

    <h3>Tarea funcional — Autopresentación profesional</h3>
    <ul>
      {% for x in reporte["fortalezas"]["funcional"] %}
        <li><b>{{ x }}</b></li>
      {% endfor %}
    </ul>

    <h3>Tarea situacional — Manejo de situación laboral</h3>
    <ul>
      {% for x in reporte["fortalezas"]["situacional"] %}
        <li><b>{{ x }}</b></li>
      {% endfor %}
    </ul>
  </div>

  <!-- ================================================= -->
  <!-- OPORTUNIDADES -->
  <!-- ================================================= -->
  <div class="card">
    <h2>Oportunidades de mejora (entrevista o entrenamiento)</h2>

    <h3>Tarea funcional</h3>
    <ul>
      {% for x in reporte["oportunidades"]["funcional"] %}
        <li>{{ x }}</li>
      {% endfor %}
    </ul>

    <h3>Tarea situacional</h3>
    <ul>
      {% for x in reporte["oportunidades"]["situacional"] %}
        <li>{{ x }}</li>
      {% endfor %}
    </ul>
  </div>

  <!-- ================================================= -->
  <!-- PERSONALIDAD -->
  <!-- ================================================= -->
  <div class="card">
    <h2>Señales del perfil de personalidad (IPIP-100)</h2>
    <ul>
      {% for s in reporte["ipip_senales"] %}
        <li>{{ s }}</li>
      {% endfor %}
    </ul>
  </div>

  <!-- ================================================= -->
  <!-- RECOMENDACIONES -->
  <!-- ================================================= -->
  <div class="card">
    <h2>Orientaciones para uso del resultado (RR.HH.)</h2>
    <ul>
      {% for r in reporte["recomendaciones"] %}
        <li>{{ r }}</li>
      {% endfor %}
    </ul>
    <div class="small">{{ reporte["disclaimer"] }}</div>
  </div>

  <!-- ================================================= -->
  <!-- DETALLE NUMÉRICO (APOYO) -->
  <!-- ================================================= -->
  <div class="card muted">
    <h2>Detalle técnico de apoyo</h2>

    <p><b>Score comunicativo global:</b> {{ sg if sg is not none else "—" }}</p>

    <h3>Funcional</h3>
    <ul>
      <li>Coherencia: {{ sf["coherencia"] }}</li>
      <li>Relevancia: {{ sf["relevancia"] }}</li>
      <li>Registro: {{ sf["registro"] }}</li>
      <li>Desarrollo: {{ sf["desarrollo"] }}</li>
      <li>Tono (alerta): {{ sf["alerta_emocion"] }}</li>
      <li><b>Global funcional:</b> {{ sf["global"] }}</li>
    </ul>

    <h3>Situacional</h3>
    <ul>
      <li>Coherencia: {{ ss["coherencia"] }}</li>
      <li>Relevancia: {{ ss["relevancia"] }}</li>
      <li>Registro: {{ ss["registro"] }}</li>
      <li>Desarrollo: {{ ss["desarrollo"] }}</li>
      <li>Tono (alerta): {{ ss["alerta_emocion"] }}</li>
      <li><b>Global situacional:</b> {{ ss["global"] }}</li>
    </ul>
  </div>

  {% if show_technical %}
  <div class="card debug">
    <h2>Diagnóstico técnico (modo debug)</h2>
    <pre>{{ analisis_discursivo["meta"] }}</pre>
  </div>
  {% endif %}

</div>

<!-- ================================================= -->
<!-- CHART.JS SCRIPTS -->
<!-- ================================================= -->
<script>
  const colorPrimary = '#2563eb';
  const colorSecondary = '#10b981';
  const colorMuted = '#9ca3af';

  // Global
  new Chart(document.getElementById('chartGlobal'), {
    type: 'bar',
    data: {
      labels: ['Score global'],
      datasets: [{
        data: [{{ sg if sg is not none else 0 }}],
        backgroundColor: colorPrimary
      }]
    },
    options: {
      indexAxis: 'y',
      scales: { x: { min: 0, max: 100 } },
      plugins: { legend: { display: false } }
    }
  });

  // Funcional vs Situacional
  new Chart(document.getElementById('chartTasks'), {
    type: 'bar',
    data: {
      labels: ['Funcional', 'Situacional'],
      datasets: [{
        data: [
          {{ sf["global"] if sf["global"] is not none else 0 }},
          {{ ss["global"] if ss["global"] is not none else 0 }}
        ],
        backgroundColor: [colorPrimary, colorSecondary]
      }]
    },
    options: {
      indexAxis: 'y',
      scales: { x: { min: 0, max: 100 } },
      plugins: { legend: { display: false } }
    }
  });

  // IPIP
  new Chart(document.getElementById('chartIPIP'), {
    type: 'bar',
    data: {
      labels: ['CON', 'NEU', 'EXT', 'AGR', 'OPE'],
      datasets: [{
        data: [
          {{ avg_scores["CON"] or 0 }},
          {{ avg_scores["NEU"] or 0 }},
          {{ avg_scores["EXT"] or 0 }},
          {{ avg_scores["AGR"] or 0 }},
          {{ avg_scores["OPE"] or 0 }}
        ],
        backgroundColor: colorMuted
      }]
    },
    options: {
      scales: { y: { min: 1, max: 5 } },
      plugins: { legend: { display: false } }
    }
  });
</script>

</body>
</html>
